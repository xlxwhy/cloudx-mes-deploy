webpackJsonp([171],{SOUS:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=a("Gu7T"),s=a.n(l),i=a("BO1k"),n=a.n(i),r={props:{select:{type:Object,default:function(){return{dialog:{visible:!1},rows:[]}}}},data:function(){return{partsId:"",selectCartypeVisible:!1,table:{loading:!1,query:{multipleInput:{name:"partsName",values:{}},intevalInputPrice:{}},sort:{descs:["updateTime"]},page:this.$gtmc.initPage()},typeOptions:{adapter:function(e){return{label:e.name,value:e.partsTypeId}},values:[]},tempRows:[]}},watch:{"select.dialog.visible":{handler:function(e,t){var a=this;e&&(this.tempRows=this.$mergeByKey(this.select.rows,[],"partsId"),this.$nextTick(function(){a.checkSelectionRow()}))},deep:!0}},mounted:function(){this.loadTable(),this.loadTypes()},methods:{showVehicle:function(e){this.selectCartypeVisible=!0,this.partsId=e},checkSelectionRow:function(){if(this.$refs.table&&(this.$refs.table.clearSelection(),this.select.rows)){var e=!0,t=!1,a=void 0;try{for(var l,s=n()(this.tempRows);!(e=(l=s.next()).done);e=!0){var i=l.value,r=!0,o=!1,c=void 0;try{for(var p,d=n()(this.table.page.records);!(r=(p=d.next()).done);r=!0){var u=p.value;u.partsId==i.partsId&&this.$refs.table.toggleRowSelection(u,!0)}}catch(e){o=!0,c=e}finally{try{!r&&d.return&&d.return()}finally{if(o)throw c}}}}catch(e){t=!0,a=e}finally{try{!e&&s.return&&s.return()}finally{if(t)throw a}}}},handleClean:function(){this.table.query.multipleInput.name="partsName"},loadTypes:function(){var e=this;this.$api.PartsTypeController.list({},function(t){t.body&&(e.typeOptions.values=[{name:"全部",partsTypeId:null}].concat(s()(t.body)))})},loadTable:function(){var e=this,t=this.handleQueryParam();this.table.loading=!0,this.$api.PartsController.page(t,function(t){e.table.loading=!1,e.$gtmc.assembleBody(e.table.page,t.body),e.$nextTick(function(){e.checkSelectionRow()})})},handleQueryParam:function(){var e=this.$gtmc.assemblePage(this.table),t=this.table.query;return this.$gtmc.appendFilter(e.body.filters,"partsTypeId","eq",t.partsTypeId),this.$gtmc.appendFilterMultipleInput(e.body.filters,t.multipleInput),this.$gtmc.appendFilterDataTime(e.body.filters,"updateTime",t.updateTime),this.$gtmc.appendFilterIntevalInput(e.body.filters,"suggestPrice",t.intevalInputPrice),console.log(e),e},handleSortChange:function(e){var t=e.prop;this.table.page.ascs=[],this.table.page.descs=[],"ascending"===e.order?this.table.page.ascs=[t]:"descending"==e.order?this.table.page.descs=[t]:(this.table.page.ascs=this.table.sort.ascs,this.table.page.descs=this.table.sort.descs),this.$handleQuery()},handleSelectionChange:function(e,t){var a=this.$findByKey(this.tempRows,"partsId",t.partsId);a?this.$removeByKey(this.tempRows,"partsId",a.partsId):this.tempRows=this.$mergeByKey([t],this.tempRows,"partsId")},handleSelectAll:function(e){this.tempRows=this.$mergeByKey(e,this.tempRows,"partsId")},handleConfirm:function(){console.log(this.tempRows),this.$emit("confirm",this.tempRows),this.select.dialog.visible=!1}}},o={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"xv-select-parts "},[a("xv-detail-dialog",{attrs:{dialog:e.select.dialog},on:{confirm:e.handleConfirm}},[a("xv-list-query",{attrs:{cleanText:"清除查询条件",table:e.table},on:{query:function(t){return e.$handleQuery()},clean:e.handleClean}},[a("xv-field-multiple-input",{attrs:{entity:e.table.query.multipleInput,label:"选择查询类型",placeholder:"输入搜索关键字",options:{values:[{label:"零配件名称",value:"partsName"},{label:"零配件编号",value:"partsCode"},{label:"适用车型Model",value:"modelCode",operator:"eq"}]}},on:{done:function(t){return e.$handleInputQuery()}}}),e._v(" "),a("xv-field-select",{attrs:{entity:e.table.query,name:"partsTypeId",label:"所属品类",placeholder:"请选择",options:e.typeOptions}}),e._v(" "),a("xv-interval-input",{attrs:{entity:e.table.query.intevalInputPrice,label:"SRP价格范围",placeholder:""},on:{done:function(t){return e.$handleInputQuery()}}}),a("br"),e._v(" "),a("xv-field-datetime",{attrs:{entity:e.table.query,name:"updateTime",label:"更新时间"}})],1),e._v(" "),a("div",{staticClass:"xv-list-table"},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.table.loading,expression:"table.loading"}],ref:"table",staticStyle:{width:"100%"},attrs:{border:"",data:e.table.page.records,"tooltip-effect":"light","header-row-class-name":"gtmc-list-table-header","row-key":"partsId"},on:{"sort-change":e.handleSortChange,select:e.handleSelectionChange,"select-all":e.handleSelectAll}},[a("el-table-column",{attrs:{type:"selection",width:"55",align:"center"}}),e._v(" "),a("xv-table-column-text",{attrs:{prop:"partsName",label:"零配件名称",width:"200",sortable:""}}),e._v(" "),a("xv-table-column-text",{attrs:{prop:"partsCode",label:"零配件编号",width:"150",sortable:""}}),e._v(" "),a("xv-table-column-text",{attrs:{prop:"partsTypeName",label:"所属品类",width:"120",sortable:""}}),e._v(" "),a("xv-table-column-amount",{attrs:{prop:"suggestPrice",label:"SRP价格",width:"100",sortable:""}}),e._v(" "),a("xv-table-column-description",{attrs:{prop:"description",label:"零配件说明"}}),e._v(" "),a("xv-table-column-date-time",{attrs:{prop:"updateTime",label:"更新时间"}}),e._v(" "),a("xv-table-column-action",{key:e.$columnKey(),attrs:{width:"90"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("xv-button-text",{attrs:{name:"适用车型"},on:{click:function(a){return e.showVehicle(t.row.partsId)}}})]}}])})],1)],1),e._v(" "),a("xv-list-page",{attrs:{table:e.table},on:{change:function(t){return e.$handleQuery()}}})],1),e._v(" "),a("xv-select-cartype",{attrs:{visible:e.selectCartypeVisible,id:e.partsId},on:{"update:visible":function(t){e.selectCartypeVisible=t}}})],1)},staticRenderFns:[]};var c=a("VU/8")(r,o,!1,function(e){a("fS6v")},null,null);t.default=c.exports},fS6v:function(e,t){}});