webpackJsonp([148],{IpCp:function(e,l){},gbXH:function(e,l,t){"use strict";Object.defineProperty(l,"__esModule",{value:!0});var i=t("Gu7T"),r=t.n(i),n=t("BO1k"),a=t.n(n),o={props:{vehicle:{type:Object,default:function(){return{dialog:{visible:!1,loading:!1},readonly:!1,tree:{},selected:[]}}}},data:function(){return{defaultNodeKeys:[],allChecked:!1}},created:function(){this.loadVehicle()},watch:{"vehicle.dialog.visible":{handler:function(e,l){var t=this;e&&(console.log(this.vehicle.readonly),this.enable(this.vehicle.tree,this.vehicle.readonly),this.defaultNodeKeys=this.findModelNodeKeys(this.vehicle.tree,this.vehicle.selected),this.$nextTick(function(){t.$refs.vehicleTree.filter()}))},deep:!0}},methods:{handleFilter:function(e,l,t){return!this.vehicle.readonly||this.defaultNodeKeys.indexOf(l.id)>=0},handleDisabled:function(e,l){console.log(e,l)},handleAll:function(){this.allChecked=!this.allChecked;var e=!0,l=!1,t=void 0;try{for(var i,r=a()(this.vehicle.tree);!(e=(i=r.next()).done);e=!0){var n=i.value;this.$refs.vehicleTree.setChecked(n,this.allChecked,!0)}}catch(e){l=!0,t=e}finally{try{!e&&r.return&&r.return()}finally{if(l)throw t}}},handleConfirm:function(){this.$emit("confirm",this.toModel()),this.vehicle.dialog.visible=!1},buildTreeKey:function(e,l){return 1e4*e+l},toTree:function(e){var l=[],t=0,i=0,r=!0,n=!1,o=void 0;try{for(var d,c=a()(e);!(r=(d=c.next()).done);r=!0){var h=d.value;t++;var v={id:this.buildTreeKey(t,0),label:h.vehName+"（"+h.vehNameCode+"）",vehName:h.vehName,vehNameCode:h.vehNameCode,level:1,children:[]};l.push(v);var s=!0,f=!1,u=void 0;try{for(var y,m=a()(h.modelCodes);!(s=(y=m.next()).done);s=!0){var C=y.value;i++,v.children.push({id:this.buildTreeKey(t,i),label:C,code:C,parent:v,level:2})}}catch(e){f=!0,u=e}finally{try{!s&&m.return&&m.return()}finally{if(f)throw u}}}}catch(e){n=!0,o=e}finally{try{!r&&c.return&&c.return()}finally{if(n)throw o}}return l},toModel:function(){var e=this.$refs.vehicleTree.getCheckedNodes(),l=this.$refs.vehicleTree.getHalfCheckedNodes(),t=[].concat(r()(e),r()(l)),i=this.$refs.vehicleTree.getCheckedKeys();console.log(t);var n=[],o=!0,d=!1,c=void 0;try{for(var h,v=a()(t);!(o=(h=v.next()).done);o=!0){var s=h.value;if(1==s.level){var f={vehName:s.vehName,vehNameCode:s.vehNameCode,modelCodes:[]},u=!0,y=!1,m=void 0;try{for(var C,g=a()(s.children);!(u=(C=g.next()).done);u=!0){var b=C.value;i.indexOf(b.id)>=0&&f.modelCodes.push(b.code)}}catch(e){y=!0,m=e}finally{try{!u&&g.return&&g.return()}finally{if(y)throw m}}n.push(f)}}}catch(e){d=!0,c=e}finally{try{!o&&v.return&&v.return()}finally{if(d)throw c}}return n},findModelNodeKeys:function(e,l){var t=[],i=!0,r=!1,n=void 0;try{for(var o,d=a()(e);!(i=(o=d.next()).done);i=!0){var c=o.value,h=!0,v=!1,s=void 0;try{for(var f,u=a()(c.children);!(h=(f=u.next()).done);h=!0){var y=f.value,m=!0,C=!1,g=void 0;try{for(var b,p=a()(l);!(m=(b=p.next()).done);m=!0){var N=b.value,k=c.vehNameCode==N.vehNameCode,x=N.modelCodes.indexOf(y.code)>=0;k&&x&&t.push(y.id)}}catch(e){C=!0,g=e}finally{try{!m&&p.return&&p.return()}finally{if(C)throw g}}}}catch(e){v=!0,s=e}finally{try{!h&&u.return&&u.return()}finally{if(v)throw s}}}}catch(e){r=!0,n=e}finally{try{!i&&d.return&&d.return()}finally{if(r)throw n}}return t},enable:function(e,l){var t=!0,i=!1,r=void 0;try{for(var n,o=a()(e);!(t=(n=o.next()).done);t=!0){var d=n.value;d.disabled=l;var c=!0,h=!1,v=void 0;try{for(var s,f=a()(d.children);!(c=(s=f.next()).done);c=!0){s.value.disabled=l}}catch(e){h=!0,v=e}finally{try{!c&&f.return&&f.return()}finally{if(h)throw v}}}}catch(e){i=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(i)throw r}}return[]},loadVehicle:function(){var e=this;this.vehicle.dialog.loading=!0,this.$api.VehicleController.listSeriesModel({},function(l){e.vehicle.tree=e.toTree(l.body),e.defaultNodeKeys=e.findModelNodeKeys(e.vehicle.tree,e.vehicle.selected),e.vehicle.dialog.loading=!1})}}},d={render:function(){var e=this,l=e.$createElement,t=e._self._c||l;return t("div",{staticClass:"basic-parts-detail-vehicle-dialog"},[t("gtmc-detail-dialog",{attrs:{dialog:e.vehicle.dialog,closeConfirm:!1},on:{confirm:e.handleConfirm}},[t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.vehicle.dialog.loading,expression:"vehicle.dialog.loading"}],staticClass:"basic-parts-detail-vehicle-dialog__content"},[t("el-tree",{ref:"vehicleTree",attrs:{data:e.vehicle.tree,"show-checkbox":!e.vehicle.readonly,"node-key":"id","default-expanded-keys":[],"default-checked-keys":e.defaultNodeKeys,"filter-node-method":e.handleFilter}})],1),e._v(" "),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e.vehicle.readonly?e._e():t("el-button",{on:{click:function(l){return e.handleAll()}}},[e._v(e._s(e.allChecked?"取消全选":"全选"))]),e._v(" "),e.vehicle.readonly?e._e():t("el-button",{attrs:{type:"primary"},on:{click:function(l){return e.handleConfirm()}}},[e._v("确 定")]),e._v(" "),t("el-button",{on:{click:function(l){e.vehicle.dialog.visible=!1}}},[e._v("取 消")])],1)])],1)},staticRenderFns:[]};var c=t("VU/8")(o,d,!1,function(e){t("IpCp")},null,null);l.default=c.exports}});